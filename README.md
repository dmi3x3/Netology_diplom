# –î–∏–ø–ª–æ–º–Ω—ã–π –ø—Ä–∞–∫—Ç–∏–∫—É–º –≤ Yandex.Cloud
  * [–¶–µ–ª–∏:](#—Ü–µ–ª–∏)
  * [–≠—Ç–∞–ø—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:](#—ç—Ç–∞–ø—ã-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
     * [–°–æ–∑–¥–∞–Ω–∏–µ –æ–±–ª–∞—á–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã](#—Å–æ–∑–¥–∞–Ω–∏–µ-–æ–±–ª–∞—á–Ω–æ–π-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã)
     * [–°–æ–∑–¥–∞–Ω–∏–µ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞](#—Å–æ–∑–¥–∞–Ω–∏–µ-kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞)
     * [–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#—Å–æ–∑–¥–∞–Ω–∏–µ-—Ç–µ—Å—Ç–æ–≤–æ–≥–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
     * [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ c–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –¥–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-c–∏—Å—Ç–µ–º—ã-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞-–∏-–¥–µ–ø–ª–æ–π-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
     * [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-cicd)
  * [–ß—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Å–¥–∞—á–∏ –∑–∞–¥–∞–Ω–∏—è?](#—á—Ç–æ-–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ-–¥–ª—è-—Å–¥–∞—á–∏-–∑–∞–¥–∞–Ω–∏—è)
  * [–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –¥–∏–ø–ª–æ–º–Ω–æ–º—É —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é?](#–∫–∞–∫-–ø—Ä–∞–≤–∏–ª—å–Ω–æ-–∑–∞–¥–∞–≤–∞—Ç—å-–≤–æ–ø—Ä–æ—Å—ã-–¥–∏–ø–ª–æ–º–Ω–æ–º—É-—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é)

---
## –¶–µ–ª–∏:

1. –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–±–ª–∞—á–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞ –±–∞–∑–µ –æ–±–ª–∞—á–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ.
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏ —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å Kubernetes –∫–ª–∞—Å—Ç–µ—Ä.
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–±–æ—Ä–∫—É —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
6. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CD –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

---
## –≠—Ç–∞–ø—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:


### –°–æ–∑–¥–∞–Ω–∏–µ –æ–±–ª–∞—á–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª –æ–±–ª–∞—á–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ –Ø–û –ø—Ä–∏ –ø–æ–º–æ—â–∏ [Terraform](https://www.terraform.io/).

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

- –ë—é–¥–∂–µ—Ç –∫—É–ø–æ–Ω–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω, —á—Ç–æ —Å–ª–µ–¥—É–µ—Ç –∏–º–µ—Ç—å –≤ –≤–∏–¥—É –ø—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤;
- –°–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç–∞–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é [Terraform](https://www.terraform.io/).

–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –∑–∞–ø—É—Å–∫—É Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞.

1. –°–æ–∑–¥–∞–ª —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è Terraform –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏. –ù–µ —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∞ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª [backend](https://www.terraform.io/docs/language/settings/backends/index.html) –¥–ª—è Terraform:
   –í—ã–±—Ä–∞–ª –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: S3 bucket –≤ —Å–æ–∑–¥–∞–Ω–Ω–æ–º –Ø–û –∞–∫–∫–∞—É–Ω—Ç–µ
3. –ù–∞—Å—Ç—Ä–æ–∏–ª [workspaces](https://www.terraform.io/docs/language/state/workspaces.html)  
   –í—ã–±—Ä–∞–ª —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç: —Å–æ–∑–¥–∞–ª –¥–≤–∞ workspace: *stage* –∏ *prod*. –ü–ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç —Ñ–∞–∫—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö workspace.
4. –°–æ–∑–¥–∞–ª VPC —Å –ø–æ–¥—Å–µ—Ç—è–º–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –∑–æ–Ω–∞—Ö –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.
   ![img_32.png](img/img_32.png)
   ![img_30.png](img/img_30.png)
   
   
5. –£–±–µ–¥–∏–ª—Å—è, —á—Ç–æ —Ç–µ–ø–µ—Ä—å –º–æ–≥—É –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã `terraform destroy` –∏ `terraform apply` –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.
![img_25.png](img/img_25.png)
![img_26.png](img/img_26.png)
```commandline
(venv) dmitriy@dellix:~/Netology_diplom/terraform$ terraform apply -auto-approve
yandex_vpc_network.netology-diplom: Refreshing state... [id=enp1s8n25p666pak07m9]
yandex_vpc_subnet.subnet-zones[2]: Refreshing state... [id=b0cenq7ogulpaubebgtj]
yandex_vpc_subnet.subnet-zones[0]: Refreshing state... [id=e9b6pa7l0ltqle1lddj1]
yandex_vpc_subnet.subnet-zones[1]: Refreshing state... [id=e2l4g748js7njec4pft9]
yandex_compute_instance.cluster-k8s[0]: Refreshing state... [id=fhmqrrj9b32u8jno9rgq]
yandex_compute_instance.cluster-k8s[1]: Refreshing state... [id=epd5fjd54mrcdhmg4gto]
yandex_compute_instance.cluster-k8s[2]: Refreshing state... [id=ef31ddqaa9t42fgkg7og]
.........
null_resource.atlantis_apply (local-exec): statefulset.apps/atlantis created
null_resource.atlantis_apply: Creation complete after 1s [id=5987107476719569254]

Apply complete! Resources: 6 added, 2 changed, 1 destroyed.

Outputs:

external_ip_address_nodes = {
  "stage-node-0" = "158.160.101.140"
  "stage-node-1" = "130.193.40.60"
  "stage-node-2" = "51.250.41.238"
}
external_load_balancer_ip = "158.160.35.78"
internal_ip_address_nodes = {
  "stage-node-0" = "10.10.1.17"
  "stage-node-1" = "10.10.2.27"
  "stage-node-2" = "10.10.3.29"
}
```

–ü–æ–ª—É—á–∏–ª –æ–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:

1. Terraform —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º Terraform –≤–æ–∑–º–æ–∂–Ω–æ –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä—É—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π.
   ![img_31.png](img/img_31.png)
2. –ü–æ–ª—É—á–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π, –ø–æ—ç—Ç–æ–º—É –≤ —Ö–æ–¥–µ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è.

---
### –°–æ–∑–¥–∞–Ω–∏–µ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞

–°–æ–∑–¥–∞–ª [Kubernetes](https://kubernetes.io/ru/docs/concepts/overview/what-is-kubernetes/) –∫–ª–∞—Å—Ç–µ—Ä –Ω–∞ –±–∞–∑–µ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.  –û–±–µ—Å–ø–µ—á–∏–ª –¥–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º –∏–∑ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–∞.

–° –ø–æ–º–æ—â—å—é —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–≥–æ –≤–∞–∏–∞–Ω—Ç–∞:

   —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞.  
   –∞. –ü—Ä–∏ –ø–æ–º–æ—â–∏ Terraform –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–∞–∫ –º–∏–Ω–∏–º—É–º 3 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω—ã Compute Cloud –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞. –¢–∏–ø –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã —Å–ª–µ–¥—É–µ—Ç –≤—ã–±—Ä–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Å —É—á—ë—Ç–æ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–∏ –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏. –ï—Å–ª–∏ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø–æ–π–º–µ—Ç–µ, —á—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–º–µ–Ω–∏—Ç—å —Ç–∏–ø –∏–Ω—Å—Ç–∞–Ω—Å–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Terraform –¥–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π.  
   –±. –ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª [ansible](https://www.ansible.com/) [–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏](https://raw.githubusercontent.com/dmi3x3/netology_diplom/main/example_stage-inventory), –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è, [Kubespray](https://kubernetes.io/docs/setup/production-environment/tools/kubespray/)  
   –≤. –ó–∞–¥–µ–ø–ª–æ–∏–ª Kubernetes –Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞–Ω–µ–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã, –≤ —Å–ª—É—á–∞–µ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –∫–∞–∫–∏—Ö-–ª–∏–±–æ —Ä–µ—Å—É—Ä—Å–æ–≤ –≤—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∏—Ö –ø—Ä–∏ –ø–æ–º–æ—â–∏ Terraform.
  
–ü–æ–ª—É—á–∏–ª –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

1. –†–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω—ã–π Kubernetes –∫–ª–∞—Å—Ç–µ—Ä.


<details>
<summary>Kubernetes –∫–ª–∞—Å—Ç–µ—Ä</summary>

```commandline
(venv) dmitriy@dellix:~/Netology_diplom/terraform$ kubectl get all --all-namespaces
NAMESPACE     NAME                                            READY   STATUS     RESTARTS        AGE
atlantis      pod/atlantis-0                                  1/1     Running    0               3m49s
jenkins       pod/jenkins-j-instance                          1/1     Running    0               19m
jenkins       pod/jenkins-operator-6bd8bdf7fd-t8z6s           1/1     Running    0               3h51m
jenkins       pod/seed-job-agent-j-instance-bcbdc5687-v5xbl   1/1     Running    0               16m
kube-system   pod/calico-kube-controllers-6dfcdfb99-94gw4     1/1     Running    0               3h54m
kube-system   pod/calico-node-7jgf4                           1/1     Running    0               3h55m
kube-system   pod/calico-node-dgrcc                           1/1     Running    0               3h55m
kube-system   pod/calico-node-q4gq6                           1/1     Running    0               3h55m
kube-system   pod/coredns-645b46f4b6-cgkbt                    1/1     Running    0               3h53m
kube-system   pod/coredns-645b46f4b6-lhc2z                    1/1     Running    0               3h53m
kube-system   pod/dns-autoscaler-659b8c48cb-jzbm9             1/1     Running    0               3h53m
kube-system   pod/kube-apiserver-stage-node-0                 1/1     Running    1               3h56m
kube-system   pod/kube-controller-manager-stage-node-0        1/1     Running    2               3h56m
kube-system   pod/kube-proxy-5zrm4                            1/1     Running    0               3h55m
kube-system   pod/kube-proxy-cmp6l                            1/1     Running    0               3h55m
kube-system   pod/kube-proxy-v7xgh                            1/1     Running    0               3h55m
kube-system   pod/kube-scheduler-stage-node-0                 1/1     Running    1               3h56m
kube-system   pod/nginx-proxy-stage-node-1                    1/1     Running    0               3h54m
kube-system   pod/nginx-proxy-stage-node-2                    1/1     Running    0               3h54m
kube-system   pod/nodelocaldns-5mzt8                          1/1     Running    0               3h53m
kube-system   pod/nodelocaldns-bnxvf                          1/1     Running    0               3h53m
kube-system   pod/nodelocaldns-z62c5                          1/1     Running    0               3h53m
monitoring    pod/alertmanager-main-0                         2/2     Running    1 (3h51m ago)   3h52m
monitoring    pod/alertmanager-main-1                         2/2     Running    0               3h52m
monitoring    pod/alertmanager-main-2                         2/2     Running    1 (3h51m ago)   3h52m
monitoring    pod/blackbox-exporter-6495c95d8f-6gp8v          3/3     Running    0               3h52m
monitoring    pod/grafana-68598fdf49-wgbz5                    1/1     Running    0               3h52m
monitoring    pod/kube-state-metrics-7cc68994c-mt7d2          3/3     Running    0               3h52m
monitoring    pod/node-exporter-2bz64                         2/2     Running    0               3h52m
monitoring    pod/node-exporter-c46h5                         2/2     Running    0               3h52m
monitoring    pod/node-exporter-klbvq                         2/2     Running    0               3h52m
monitoring    pod/prometheus-adapter-779df64887-blvtp         1/1     Running    0               3h52m
monitoring    pod/prometheus-adapter-779df64887-kd2g9         1/1     Running    0               3h52m
monitoring    pod/prometheus-k8s-0                            2/2     Running    0               3h52m
monitoring    pod/prometheus-k8s-1                            2/2     Running    0               3h52m
monitoring    pod/prometheus-operator-8d5b96fc9-gq7wj         2/2     Running    0               3h52m
stage         pod/app-web-app-web-repo-6f95967898-pkcck       1/1     Running    0               3h52m

NAMESPACE     NAME                                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                        AGE
atlantis      service/atlantis                            ClusterIP   10.233.49.148   <none>        4141/TCP                       3m50s
atlantis      service/atlantis-public                     NodePort    10.233.47.124   <none>        4141:30141/TCP                 3m49s
default       service/kubernetes                          ClusterIP   10.233.0.1      <none>        443/TCP                        3h56m
jenkins       service/jenkins-operator-http-j-instance    NodePort    10.233.63.104   <none>        8080:30808/TCP                 21m
jenkins       service/jenkins-operator-slave-j-instance   ClusterIP   10.233.1.194    <none>        50000/TCP                      21m
kube-system   service/coredns                             ClusterIP   10.233.0.3      <none>        53/UDP,53/TCP,9153/TCP         3h53m
kube-system   service/kubelet                             ClusterIP   None            <none>        10250/TCP,10255/TCP,4194/TCP   3h52m
monitoring    service/alertmanager-main                   ClusterIP   10.233.32.200   <none>        9093/TCP,8080/TCP              3h53m
monitoring    service/alertmanager-operated               ClusterIP   None            <none>        9093/TCP,9094/TCP,9094/UDP     3h52m
monitoring    service/blackbox-exporter                   ClusterIP   10.233.23.23    <none>        9115/TCP,19115/TCP             3h53m
monitoring    service/grafana                             NodePort    10.233.39.159   <none>        3000:30030/TCP                 3h53m
monitoring    service/kube-state-metrics                  ClusterIP   None            <none>        8443/TCP,9443/TCP              3h53m
monitoring    service/node-exporter                       ClusterIP   None            <none>        9100/TCP                       3h53m
monitoring    service/prometheus-adapter                  ClusterIP   10.233.1.203    <none>        443/TCP                        3h53m
monitoring    service/prometheus-k8s                      ClusterIP   10.233.60.145   <none>        9090/TCP,8080/TCP              3h53m
monitoring    service/prometheus-operated                 ClusterIP   None            <none>        9090/TCP                       3h52m
monitoring    service/prometheus-operator                 ClusterIP   None            <none>        8443/TCP                       3h53m
stage         service/app-web-app-web-repo                NodePort    10.233.58.34    <none>        80:30080/TCP                   3h52m

NAMESPACE     NAME                           DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
kube-system   daemonset.apps/calico-node     3         3         3       3            3           kubernetes.io/os=linux   3h55m
kube-system   daemonset.apps/kube-proxy      3         3         3       3            3           kubernetes.io/os=linux   3h56m
kube-system   daemonset.apps/nodelocaldns    3         3         3       3            3           kubernetes.io/os=linux   3h53m
monitoring    daemonset.apps/node-exporter   3         3         3       3            3           kubernetes.io/os=linux   3h53m

NAMESPACE     NAME                                        READY   UP-TO-DATE   AVAILABLE   AGE
jenkins       deployment.apps/jenkins-operator            1/1     1            1           3h51m
jenkins       deployment.apps/seed-job-agent-j-instance   1/1     1            1           16m
kube-system   deployment.apps/calico-kube-controllers     1/1     1            1           3h54m
kube-system   deployment.apps/coredns                     2/2     2            2           3h53m
kube-system   deployment.apps/dns-autoscaler              1/1     1            1           3h53m
monitoring    deployment.apps/blackbox-exporter           1/1     1            1           3h53m
monitoring    deployment.apps/grafana                     1/1     1            1           3h53m
monitoring    deployment.apps/kube-state-metrics          1/1     1            1           3h53m
monitoring    deployment.apps/prometheus-adapter          2/2     2            2           3h53m
monitoring    deployment.apps/prometheus-operator         1/1     1            1           3h53m
stage         deployment.apps/app-web-app-web-repo        1/1     1            1           3h52m

NAMESPACE     NAME                                                  DESIRED   CURRENT   READY   AGE
jenkins       replicaset.apps/jenkins-operator-6bd8bdf7fd           1         1         1       3h51m
jenkins       replicaset.apps/seed-job-agent-j-instance-bcbdc5687   1         1         1       16m
kube-system   replicaset.apps/calico-kube-controllers-6dfcdfb99     1         1         1       3h54m
kube-system   replicaset.apps/coredns-645b46f4b6                    2         2         2       3h53m
kube-system   replicaset.apps/dns-autoscaler-659b8c48cb             1         1         1       3h53m
monitoring    replicaset.apps/blackbox-exporter-6495c95d8f          1         1         1       3h52m
monitoring    replicaset.apps/grafana-68598fdf49                    1         1         1       3h52m
monitoring    replicaset.apps/kube-state-metrics-7cc68994c          1         1         1       3h52m
monitoring    replicaset.apps/prometheus-adapter-779df64887         2         2         2       3h52m
monitoring    replicaset.apps/prometheus-operator-8d5b96fc9         1         1         1       3h52m
stage         replicaset.apps/app-web-app-web-repo-6f95967898       1         1         1       3h52m

NAMESPACE    NAME                                 READY   AGE
atlantis     statefulset.apps/atlantis            0/1     3m49s
monitoring   statefulset.apps/alertmanager-main   3/3     3h52m
monitoring   statefulset.apps/prometheus-k8s      2/2     3h52m
```

</details>

2. –í —Ñ–∞–π–ª–µ `~/.kube/config` –Ω–∞—Ö–æ–¥—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É.
–î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É —Å–æ—Ö—Ä–∞–Ω–∏–ª –≤ —Ñ–∞–π–ª /home/dmitriy/kubectl-yc-config-dipl-stage, –∞ —Ä–∞–±–æ—Ç—É –∫–æ–º–∞–Ω–¥–∞ kubectl –æ–±–µ—Å–ø–µ—á–∏–ª —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è KUBECONFIG.

3. –ö–æ–º–∞–Ω–¥–∞ `kubectl get pods --all-namespaces` –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫.

<details>
<summary>–í—ã–≤–æ–¥ –Ω–∞ –∫–æ–Ω—Å–æ–ª—å</summary>

```commandline
(venv) dmitriy@dellix:~/Netology_diplom/terraform$ kubectl get pods --all-namespaces
NAMESPACE     NAME                                        READY   STATUS     RESTARTS        AGE
atlantis      atlantis-0                                  1/1     Running    0               3h54m
jenkins       jenkins-j-instance                          1/1     Running    0               22m
jenkins       jenkins-operator-6bd8bdf7fd-t8z6s           1/1     Running    0               3h54m
jenkins       seed-job-agent-j-instance-bcbdc5687-v5xbl   1/1     Running    0               19m
kube-system   calico-kube-controllers-6dfcdfb99-94gw4     1/1     Running    0               3h57m
kube-system   calico-node-7jgf4                           1/1     Running    0               3h57m
kube-system   calico-node-dgrcc                           1/1     Running    0               3h57m
kube-system   calico-node-q4gq6                           1/1     Running    0               3h57m
kube-system   coredns-645b46f4b6-cgkbt                    1/1     Running    0               3h56m
kube-system   coredns-645b46f4b6-lhc2z                    1/1     Running    0               3h56m
kube-system   dns-autoscaler-659b8c48cb-jzbm9             1/1     Running    0               3h56m
kube-system   kube-apiserver-stage-node-0                 1/1     Running    1               3h59m
kube-system   kube-controller-manager-stage-node-0        1/1     Running    2               3h59m
kube-system   kube-proxy-5zrm4                            1/1     Running    0               3h58m
kube-system   kube-proxy-cmp6l                            1/1     Running    0               3h58m
kube-system   kube-proxy-v7xgh                            1/1     Running    0               3h58m
kube-system   kube-scheduler-stage-node-0                 1/1     Running    1               3h59m
kube-system   nginx-proxy-stage-node-1                    1/1     Running    0               3h57m
kube-system   nginx-proxy-stage-node-2                    1/1     Running    0               3h57m
kube-system   nodelocaldns-5mzt8                          1/1     Running    0               3h56m
kube-system   nodelocaldns-bnxvf                          1/1     Running    0               3h56m
kube-system   nodelocaldns-z62c5                          1/1     Running    0               3h56m
monitoring    alertmanager-main-0                         2/2     Running    1 (3h54m ago)   3h55m
monitoring    alertmanager-main-1                         2/2     Running    0               3h55m
monitoring    alertmanager-main-2                         2/2     Running    1 (3h54m ago)   3h55m
monitoring    blackbox-exporter-6495c95d8f-6gp8v          3/3     Running    0               3h55m
monitoring    grafana-68598fdf49-wgbz5                    1/1     Running    0               3h55m
monitoring    kube-state-metrics-7cc68994c-mt7d2          3/3     Running    0               3h55m
monitoring    node-exporter-2bz64                         2/2     Running    0               3h55m
monitoring    node-exporter-c46h5                         2/2     Running    0               3h55m
monitoring    node-exporter-klbvq                         2/2     Running    0               3h55m
monitoring    prometheus-adapter-779df64887-blvtp         1/1     Running    0               3h55m
monitoring    prometheus-adapter-779df64887-kd2g9         1/1     Running    0               3h55m
monitoring    prometheus-k8s-0                            2/2     Running    0               3h55m
monitoring    prometheus-k8s-1                            2/2     Running    0               3h55m
monitoring    prometheus-operator-8d5b96fc9-gq7wj         2/2     Running    0               3h55m
stage         app-web-app-web-repo-6f95967898-pkcck       1/1     Running    0               3h55m
```

</details>

---
### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —ç–º—É–ª–∏—Ä—É—é—â–µ–µ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º–æ–µ –º–æ–µ–π –∫–æ–º–ø–∞–Ω–∏–µ–π.

–°–ø–æ—Å–æ–± –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏:

–í—ã–±—Ä–∞–ª —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –≤–∞—Ä–∏–∞–Ω—Ç:  
   –∞. –°–æ–∑–¥–∞–ª –æ—Ç–¥–µ–ª—å–Ω—ã–π [git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π](https://github.com/dmi3x3/app_web) —Å –ø—Ä–æ—Å—Ç—ã–º nginx –∫–æ–Ω—Ñ–∏–≥–æ–º, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ—Ç–¥–∞–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ.  
   –±. –ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª [Dockerfile](https://github.com/dmi3x3/app_web/blob/main/Dockerfile) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–∑–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–ü–æ–ª—É—á–∏–ª –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

1. [Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π](https://github.com/dmi3x3/app_web) —Å —Ç–µ—Å—Ç–æ–≤—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –∏ [Dockerfile](https://github.com/dmi3x3/app_web/blob/main/Dockerfile) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—Ä–∞–∑–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
2. [–†–µ–≥–∏—Å—Ç—Ä —Å —Å–æ–±—Ä–∞–Ω–Ω—ã–º docker image](https://hub.docker.com/r/dmi3x3/app_web/tags). –í –∫–∞—á–µ—Å—Ç–≤–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª DockerHub.

---
### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ c–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –¥–µ–ø–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
 
–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª —Ñ–∞–π–ª—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞.
 
1. –ó–∞–¥–µ–ø–ª–æ–∏–ª –≤ –∫–ª–∞—Å—Ç–µ—Ä [prometheus](https://prometheus.io/), [grafana](https://grafana.com/), [alertmanager](https://github.com/prometheus/alertmanager), [—ç–∫—Å–ø–æ—Ä—Ç–µ—Ä](https://github.com/prometheus/node_exporter) –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫ Kubernetes.
   ![img_27.png](img/img_27.png)
   ![img_28.png](img/img_28.png)
2. –ó–∞–¥–µ–ø–ª–æ–∏–ª —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, [nginx](https://www.nginx.com/) —Å–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞—é—â–∏–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É.
   ![img_29.png](img/img_29.png)
–í—ã–±—Ä–∞–ª —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:
1. –í–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ø–∞–∫–µ—Ç–æ–º [kube-prometheus](https://github.com/prometheus-operator/kube-prometheus), –∫–æ—Ç–æ—Ä—ã–π —É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è [Kubernetes –æ–ø–µ—Ä–∞—Ç–æ—Ä](https://operatorhub.io/) –¥–ª—è [grafana](https://grafana.com/), [prometheus](https://prometheus.io/), [alertmanager](https://github.com/prometheus/alertmanager) –∏ [node_exporter](https://github.com/prometheus/node_exporter). –ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–µ—Ç–µ —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ —ç—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ.
2. –í —Ä–∞–±–æ—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é.
3. –¢.–∫. –Ω–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ —è –Ω–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è [Terraform Cloud](https://app.terraform.io/), —Ç–æ –∑–∞–¥–µ–ø–ª–æ–∏–ª –≤ –∫–ª–∞—Å—Ç–µ—Ä [atlantis](https://www.runatlantis.io/) –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.
   ![img_33.png](img/img_33.png)

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
1. [Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Kubernetes](https://github.com/dmi3x3/netology_diplom).
2. Http –¥–æ—Å—Ç—É–ø –∫ web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É grafana.
   ![img_37.png](img/img_37.png)
3. –î–∞—à–±–æ—Ä–¥—ã –≤ grafana –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞.
   ![img_35.png](img/img_35.png)
   ![img_36.png](img/img_36.png)
4. Http –¥–æ—Å—Ç—É–ø –∫ —Ç–µ—Å—Ç–æ–≤–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é.
   ![img_34.png](img/img_34.png)

---
### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD

–ù–∞—Å—Ç—Ä–æ–∏–ª ci/cd —Å–∏—Å—Ç–µ–º—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏ docker image –∏ –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞.

–¶–µ–ª—å:

1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ docker –æ–±—Ä–∞–∑–∞ –ø—Ä–∏ –∫–æ–º–º–∏—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å —Ç–µ—Å—Ç–æ–≤—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–æ–≤–æ–≥–æ docker –æ–±—Ä–∞–∑–∞.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –Ω–∞—Ç–∏–≤–Ω—ã–π kubernetes –æ–ø–µ—Ä–∞—Ç–æ—Ä [jenkins-operator](https://jenkinsci.github.io/kubernetes-operator/docs/)

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

1. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å ci/cd —Å–µ—Ä–≤–∏—Å–∞ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ http.
   ![img_38.png](img/img_38.png)
2. –ü—Ä–∏ –ª—é–±–æ–º –∫–æ–º–º–∏—Ç–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ —Å —Ç–µ—Å—Ç–æ–≤—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ—Ä–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ —Ä–µ–≥–∏—Å—Ç—Ä Docker –æ–±—Ä–∞–∑–∞.

```commandline
(venv) dmitriy@dellix:~/Netology_diplom/terraform/app_web$ git add Dockerfile && git commit -m "fix --type=kubernetes.io/dockerconfigjson file 143" && git push
[main 2b9304f] fix --type=kubernetes.io/dockerconfigjson file 143
 1 file changed, 1 insertion(+), 1 deletion(-)
–ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤: 5, –≥–æ—Ç–æ–≤–æ.
–ü–æ–¥—Å—á–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤: 100% (5/5), –≥–æ—Ç–æ–≤–æ.
–ü—Ä–∏ —Å–∂–∞—Ç–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–æ 12 –ø–æ—Ç–æ–∫–æ–≤
–°–∂–∞—Ç–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤: 100% (3/3), –≥–æ—Ç–æ–≤–æ.
–ó–∞–ø–∏—Å—å –æ–±—ä–µ–∫—Ç–æ–≤: 100% (3/3), 335 –±–∞–π—Ç–æ–≤ | 18.00 –ö–∏–ë/—Å, –≥–æ—Ç–æ–≤–æ.
–í—Å–µ–≥–æ 3 (–∏–∑–º–µ–Ω–µ–Ω–∏–π 2), –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ 0 (–∏–∑–º–µ–Ω–µ–Ω–∏–π 0), –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –ø–∞–∫–µ—Ç–æ–≤ 0
remote: Resolving deltas: 100% (2/2), completed with 2 local objects.
To github.com:dmi3x3/app_web.git
   b305576..2b9304f  main -> main
```

![img_45.png](img/img_45.png) 

![img_43.png](img/img_43.png)



<details>
<summary>–í—ã–≤–æ–¥ –Ω–∞ –∫–æ–Ω—Å–æ–ª—å</summary>

```commandline
Started by an SCM change
Checking out git https://github.com/dmi3x3/app_web.git into /var/lib/jenkins/workspace/example-job@script/979245040ed156c1d70f08ff53b0ee0a6cd1e69733169d8be8a1a569ee38086f to read cicd/pipelines/build.jenkins
The recommended git tool is: NONE
No credentials specified
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/example-job@script/979245040ed156c1d70f08ff53b0ee0a6cd1e69733169d8be8a1a569ee38086f/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/dmi3x3/app_web.git # timeout=10
Fetching upstream changes from https://github.com/dmi3x3/app_web.git
 > git --version # timeout=10
 > git --version # 'git version 2.30.2'
 > git fetch --tags --force --progress -- https://github.com/dmi3x3/app_web.git +refs/heads/*:refs/remotes/origin/* # timeout=10
Seen branch in repository origin/main
Seen 1 remote branch
 > git show-ref --tags -d # timeout=10
Checking out Revision 2b9304f780c15f54b9e2e660fbf966af52c378d7 (origin/main)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f 2b9304f780c15f54b9e2e660fbf966af52c378d7 # timeout=10
Commit message: "fix --type=kubernetes.io/dockerconfigjson file 143"
 > git rev-list --no-walk b3055764e155cd7ad25171a35c8ded960274cd47 # timeout=10
[Pipeline] Start of Pipeline
[Pipeline] podTemplate
[Pipeline] {
[Pipeline] node
Created Pod: kubernetes jenkins/example-job-6-n9lsq-1q2br-xn314
Agent example-job-6-n9lsq-1q2br-xn314 is provisioned from template example-job_6-n9lsq-1q2br
---
apiVersion: "v1"
kind: "Pod"
metadata:
  annotations:
    buildUrl: "http://jenkins-operator-http-j-instance.jenkins.svc.cluster.local:8080/job/example-job/6/"
    runUrl: "job/example-job/6/"
  labels:
    job: "build-service"
    jenkins: "slave"
    jenkins/label-digest: "edf0a182ab8596428e0473d8f3646c79e8cc8afc"
    jenkins/label: "example-job_6-n9lsq"
  name: "example-job-6-n9lsq-1q2br-xn314"
  namespace: "jenkins"
spec:
  containers:
  - command:
    - "cat"
    image: "gcr.io/kaniko-project/executor:debug"
    name: "kaniko"
    tty: true
    volumeMounts:
    - mountPath: "/kaniko/.docker/"
      name: "docker-config"
    - mountPath: "/home/jenkins/agent"
      name: "workspace-volume"
      readOnly: false
  - command:
    - "cat"
    image: "dmi3x3/helmctl:1.0.0"
    name: "helmctl"
    tty: true
    volumeMounts:
    - mountPath: "/home/jenkins/agent"
      name: "workspace-volume"
      readOnly: false
  - env:
    - name: "JENKINS_SECRET"
      value: "********"
    - name: "JENKINS_TUNNEL"
      value: "jenkins-operator-slave-j-instance.jenkins.svc.cluster.local:50000"
    - name: "JENKINS_AGENT_NAME"
      value: "example-job-6-n9lsq-1q2br-xn314"
    - name: "JENKINS_NAME"
      value: "example-job-6-n9lsq-1q2br-xn314"
    - name: "JENKINS_AGENT_WORKDIR"
      value: "/home/jenkins/agent"
    - name: "JENKINS_URL"
      value: "http://jenkins-operator-http-j-instance.jenkins.svc.cluster.local:8080/"
    image: "jenkins/inbound-agent:3107.v665000b_51092-5"
    name: "jnlp"
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
    volumeMounts:
    - mountPath: "/home/jenkins/agent"
      name: "workspace-volume"
      readOnly: false
  nodeSelector:
    kubernetes.io/os: "linux"
  restartPolicy: "Never"
  serviceAccountName: "deploy-stage1"
  volumes:
  - hostPath:
      path: "/var/run/docker.sock"
    name: "docker-sock"
  - name: "docker-config"
    secret:
      items:
      - key: ".dockerconfigjson"
        path: "config.json"
      secretName: "dockercred"
  - emptyDir:
      medium: ""
    name: "workspace-volume"

Running on example-job-6-n9lsq-1q2br-xn314 in /home/jenkins/agent/workspace/example-job
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] timestamps
[Pipeline] {
[Pipeline] stage
[Pipeline] { (checkout)
[Pipeline] script
[Pipeline] {
[Pipeline] checkout
10:40:22  The recommended git tool is: NONE
10:40:25  No credentials specified
10:40:25  Cloning the remote Git repository
10:40:25  Cloning repository https://github.com/dmi3x3/app_web.git
10:40:26   > git init /home/jenkins/agent/workspace/example-job # timeout=10
10:40:26  Fetching upstream changes from https://github.com/dmi3x3/app_web.git
10:40:26   > git --version # timeout=10
10:40:26   > git --version # 'git version 2.30.2'
10:40:26   > git fetch --tags --force --progress -- https://github.com/dmi3x3/app_web.git +refs/heads/*:refs/remotes/origin/* # timeout=10
10:40:26   > git config remote.origin.url https://github.com/dmi3x3/app_web.git # timeout=10
10:40:26   > git config --add remote.origin.fetch +refs/heads/*:refs/remotes/origin/* # timeout=10
10:40:27  Avoid second fetch
10:40:28  Checking out Revision 2b9304f780c15f54b9e2e660fbf966af52c378d7 (origin/main)
10:40:28  Commit message: "fix --type=kubernetes.io/dockerconfigjson file 143"
[Pipeline] sh
10:40:27  Seen branch in repository origin/main
10:40:27  Seen 1 remote branch
10:40:27   > git show-ref --tags -d # timeout=10
10:40:28   > git config core.sparsecheckout # timeout=10
10:40:28   > git checkout -f 2b9304f780c15f54b9e2e660fbf966af52c378d7 # timeout=10
10:40:29  + git log -1 --format=%h.%ad --date=format:%Y%m%d-%H%M
10:40:29  + cat
[Pipeline] sh
10:40:29  + git --no-pager tag --points-at HEAD
[Pipeline] echo
10:40:29  checking version tag 
[Pipeline] echo
10:40:29  tag null
[Pipeline] sh
10:40:30  + git --no-pager tag --points-at HEAD
[Pipeline] sh
10:40:30  + echo Building revision: 6-2b9304f.20230524-1039 build_tag:  gt: false
10:40:30  Building revision: 6-2b9304f.20230524-1039 build_tag:  gt: false
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build Docker Image by kaniko)
[Pipeline] container
[Pipeline] {
[Pipeline] sh
10:40:31  + pwd
10:40:31  + /kaniko/executor --dockerfile Dockerfile --context /home/jenkins/agent/workspace/example-job/ --verbosity debug --insecure --skip-tls-verify --destination dmi3x3/app_web:6-2b9304f.20230524-1039
10:40:31  [37mDEBU[0m[0000] Copying file /home/jenkins/agent/workspace/example-job/Dockerfile to /kaniko/Dockerfile 
10:40:32  [37mDEBU[0m[0001] Skip resolving path /kaniko/Dockerfile       
10:40:32  [37mDEBU[0m[0001] Skip resolving path /home/jenkins/agent/workspace/example-job/ 
10:40:32  [37mDEBU[0m[0001] Skip resolving path /cache                   
10:40:32  [37mDEBU[0m[0001] Skip resolving path                          
10:40:32  [37mDEBU[0m[0001] Skip resolving path                          
10:40:32  [37mDEBU[0m[0001] Skip resolving path                          
10:40:32  [37mDEBU[0m[0001] Skip resolving path                          
10:40:32  [37mDEBU[0m[0001] Built stage name to index map: map[]         
10:40:32  [36mINFO[0m[0001] Retrieving image manifest nginx:1.23.3       
10:40:32  [36mINFO[0m[0001] Retrieving image nginx:1.23.3 from registry index.docker.io 
10:40:34  [36mINFO[0m[0002] Built cross stage deps: map[]                
10:40:34  [36mINFO[0m[0002] Retrieving image manifest nginx:1.23.3       
10:40:34  [36mINFO[0m[0002] Returning cached image manifest              
10:40:34  [36mINFO[0m[0002] Executing 0 build triggers                   
10:40:34  [36mINFO[0m[0002] Building stage 'nginx:1.23.3' [idx: '0', base-idx: '-1'] 
10:40:34  [36mINFO[0m[0002] Unpacking rootfs as cmd ADD conf /etc/nginx requires it. 
10:40:34  [37mDEBU[0m[0002] Ignore list: [{/kaniko false} {/etc/mtab false} {/tmp/apt-key-gpghome true} {/var/run false} {/proc false} {/dev false} {/dev/pts false} {/dev/mqueue false} {/sys false} {/sys/fs/cgroup false} {/sys/fs/cgroup/systemd false} {/sys/fs/cgroup/net_cls,net_prio false} {/sys/fs/cgroup/cpu,cpuacct false} {/sys/fs/cgroup/rdma false} {/sys/fs/cgroup/freezer false} {/sys/fs/cgroup/blkio false} {/sys/fs/cgroup/memory false} {/sys/fs/cgroup/pids false} {/sys/fs/cgroup/cpuset false} {/sys/fs/cgroup/devices false} {/sys/fs/cgroup/perf_event false} {/sys/fs/cgroup/hugetlb false} {/busybox false} {/kaniko/.docker false} {/etc/hosts false} {/dev/termination-log false} {/etc/hostname false} {/etc/resolv.conf false} {/dev/shm false} {/home/jenkins/agent false} {/var/run/secrets/kubernetes.io/serviceaccount false} {/dev/console false} {/proc/bus false} {/proc/fs false} {/proc/irq false} {/proc/sys false} {/proc/sysrq-trigger false} {/proc/acpi false} {/proc/kcore false} {/proc/keys false} {/proc/timer_list false} {/proc/sched_debug false} {/proc/scsi false} {/sys/firmware false}] 
10:40:34  [37mDEBU[0m[0002] Not adding /dev because it is ignored        
10:40:34  [37mDEBU[0m[0002] Not adding /etc/hostname because it is ignored 
10:40:34  [37mDEBU[0m[0002] Not adding /etc/resolv.conf because it is ignored 
10:40:34  [37mDEBU[0m[0002] Not adding /proc because it is ignored       
10:40:34  [37mDEBU[0m[0002] Not adding /sys because it is ignored        
10:40:35  [37mDEBU[0m[0003] Not adding /var/run because it is ignored    
10:40:37  [37mDEBU[0m[0005] Resolved conf to conf                        
10:40:37  [37mDEBU[0m[0005] Resolved /etc/nginx to /etc/nginx            
10:40:37  [36mINFO[0m[0005] Using files from context: [/home/jenkins/agent/workspace/example-job/conf] 
10:40:37  [36mINFO[0m[0005] ADD conf /etc/nginx                          
10:40:37  [37mDEBU[0m[0005] Resolved conf to conf                        
10:40:37  [37mDEBU[0m[0005] Resolved /etc/nginx to /etc/nginx            
10:40:37  [37mDEBU[0m[0005] found uid -1 and gid -1 for chown string     
10:40:37  [37mDEBU[0m[0005] Resolved conf to conf                        
10:40:37  [37mDEBU[0m[0005] Resolved /etc/nginx to /etc/nginx            
10:40:37  [37mDEBU[0m[0005] Getting files and contents at root /home/jenkins/agent/workspace/example-job/conf/ for /home/jenkins/agent/workspace/example-job/conf 
10:40:37  [37mDEBU[0m[0005] Copying file /home/jenkins/agent/workspace/example-job/conf/nginx.conf to /etc/nginx/nginx.conf 
10:40:37  [37mDEBU[0m[0005] file at /etc/nginx/nginx.conf already exists, resetting file ownership to root 
10:40:37  [36mINFO[0m[0005] Taking snapshot of files...                  
10:40:37  [37mDEBU[0m[0005] Adding to layer: [/ /etc /etc/nginx /etc/nginx/nginx.conf] 
10:40:37  [37mDEBU[0m[0005] Resolved content to content                  
10:40:37  [37mDEBU[0m[0005] Resolved /usr/share/nginx/html to /usr/share/nginx/html 
10:40:37  [36mINFO[0m[0005] Using files from context: [/home/jenkins/agent/workspace/example-job/content] 
10:40:37  [36mINFO[0m[0005] ADD content /usr/share/nginx/html            
10:40:37  [37mDEBU[0m[0005] Resolved content to content                  
10:40:37  [37mDEBU[0m[0005] Resolved /usr/share/nginx/html to /usr/share/nginx/html 
10:40:37  [37mDEBU[0m[0005] found uid -1 and gid -1 for chown string     
10:40:37  [37mDEBU[0m[0005] Resolved content to content                  
10:40:37  [37mDEBU[0m[0005] Resolved /usr/share/nginx/html to /usr/share/nginx/html 
10:40:37  [37mDEBU[0m[0005] Getting files and contents at root /home/jenkins/agent/workspace/example-job/content/ for /home/jenkins/agent/workspace/example-job/content 
10:40:37  [37mDEBU[0m[0005] Copying file /home/jenkins/agent/workspace/example-job/content/index.html to /usr/share/nginx/html/index.html 
10:40:37  [37mDEBU[0m[0005] file at /usr/share/nginx/html/index.html already exists, resetting file ownership to root 
10:40:37  [36mINFO[0m[0005] Taking snapshot of files...                  
10:40:37  [37mDEBU[0m[0005] Adding to layer: [/ /usr /usr/share /usr/share/nginx /usr/share/nginx/html /usr/share/nginx/html/index.html] 
10:40:37  [36mINFO[0m[0005] EXPOSE 80                                    
10:40:37  [36mINFO[0m[0005] Cmd: EXPOSE                                  
10:40:37  [36mINFO[0m[0005] Adding exposed port: 80/tcp                  
10:40:37  [37mDEBU[0m[0005] Build: skipping snapshot for [EXPOSE 80]     
10:40:37  [37mDEBU[0m[0005] Mapping stage idx 0 to digest sha256:4e6a0d047ae917b50998e49e6aedadc90b5ccaf95f43ac2254c7b9f8388b3e79 
10:40:37  [37mDEBU[0m[0005] Mapping digest sha256:4e6a0d047ae917b50998e49e6aedadc90b5ccaf95f43ac2254c7b9f8388b3e79 to cachekey  
10:40:37  [36mINFO[0m[0005] Pushing image to dmi3x3/app_web:6-2b9304f.20230524-1039 
10:40:40  [36mINFO[0m[0008] Pushed index.docker.io/dmi3x3/app_web@sha256:e09cd3cbccecd697a7987875f04b4c381d5b0182e9d0f43ef642dc84968c8704 
[Pipeline] }
[Pipeline] // container
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (BUILD Docker Image by kaniko with Tag)
[Pipeline] sh
10:40:40  + git --no-pager tag --points-at HEAD
[Pipeline] echo
10:40:40  checking version tag 
[Pipeline] echo
10:40:40  tag null
Stage "BUILD Docker Image by kaniko with Tag" skipped due to when conditional
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Run helmctl)
[Pipeline] container
[Pipeline] {
[Pipeline] sh
10:40:41  + helm upgrade app-web-repo app-web-chart --set 'image_frontend.tag=' --install -n stage
10:40:41  Release "app-web-repo" has been upgraded. Happy Helming!
10:40:41  NAME: app-web-repo
10:40:41  LAST DEPLOYED: Wed May 24 07:40:41 2023
10:40:41  NAMESPACE: stage
10:40:41  STATUS: deployed
10:40:41  REVISION: 4
10:40:41  TEST SUITE: None
10:40:41  NOTES:
10:40:41  ---------------------------------------------------------
10:40:41  
10:40:41  Content of NOTES.txt appears after deploy.
10:40:41  Deployed version latest.
10:40:41  
10:40:41  ---------------------------------------------------------
10:40:41  + kubectl get pods -n stage
10:40:41  NAME                                    READY   STATUS              RESTARTS   AGE
10:40:41  app-web-app-web-repo-6f95967898-dv9xh   0/1     ContainerCreating   0          0s
10:40:41  app-web-app-web-repo-849c6ccbc6-fjj47   1/1     Running             0          5m49s
[Pipeline] }
[Pipeline] // container
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // timestamps
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] }
[Pipeline] // podTemplate
[Pipeline] End of Pipeline
Finished: SUCCESS
```

</details>

3. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, v1.0.149) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ—Ä–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º label –≤ —Ä–µ–≥–∏—Å—Ç—Ä, –∞ —Ç–∞–∫–∂–µ –¥–µ–ø–ª–æ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ Docker –æ–±—Ä–∞–∑–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä Kubernetes.
```commandline
(venv) dmitriy@dellix:~/Netology_diplom/terraform/app_web$ release=149; git add cicd/pipelines/build.jenkins && git commit -m "fix_${release} pipelines build.jenkins file" && git tag v1.0.${release} && git push --tags && git push
[main b305576] fix_149 pipelines build.jenkins file
 1 file changed, 1 insertion(+), 3 deletions(-)
–ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤: 9, –≥–æ—Ç–æ–≤–æ.
–ü–æ–¥—Å—á–µ—Ç –æ–±—ä–µ–∫—Ç–æ–≤: 100% (9/9), –≥–æ—Ç–æ–≤–æ.
–ü—Ä–∏ —Å–∂–∞—Ç–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–æ 12 –ø–æ—Ç–æ–∫–æ–≤
–°–∂–∞—Ç–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤: 100% (4/4), –≥–æ—Ç–æ–≤–æ.
–ó–∞–ø–∏—Å—å –æ–±—ä–µ–∫—Ç–æ–≤: 100% (5/5), 448 –±–∞–π—Ç–æ–≤ | 448.00 –ö–∏–ë/—Å, –≥–æ—Ç–æ–≤–æ.
–í—Å–µ–≥–æ 5 (–∏–∑–º–µ–Ω–µ–Ω–∏–π 2), –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ 0 (–∏–∑–º–µ–Ω–µ–Ω–∏–π 0), –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –ø–∞–∫–µ—Ç–æ–≤ 0
remote: Resolving deltas: 100% (2/2), completed with 2 local objects.
To github.com:dmi3x3/app_web.git
 * [new tag]         v1.0.149 -> v1.0.149
–í—Å–µ–≥–æ 0 (–∏–∑–º–µ–Ω–µ–Ω–∏–π 0), –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ 0 (–∏–∑–º–µ–Ω–µ–Ω–∏–π 0), –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –ø–∞–∫–µ—Ç–æ–≤ 0
To github.com:dmi3x3/app_web.git
   ff1aa1a..b305576  main -> main
```

![img_41.png](img/img_41.png)
![img_46.png](img/img_46.png)


<details>
<summary>–í—ã–≤–æ–¥ –Ω–∞ –∫–æ–Ω—Å–æ–ª—å</summary>

```commandline
Started by an SCM change
Checking out git https://github.com/dmi3x3/app_web.git into /var/lib/jenkins/workspace/example-job@script/979245040ed156c1d70f08ff53b0ee0a6cd1e69733169d8be8a1a569ee38086f to read cicd/pipelines/build.jenkins
The recommended git tool is: NONE
No credentials specified
 > git rev-parse --resolve-git-dir /var/lib/jenkins/workspace/example-job@script/979245040ed156c1d70f08ff53b0ee0a6cd1e69733169d8be8a1a569ee38086f/.git # timeout=10
Fetching changes from the remote Git repository
 > git config remote.origin.url https://github.com/dmi3x3/app_web.git # timeout=10
Fetching upstream changes from https://github.com/dmi3x3/app_web.git
 > git --version # timeout=10
 > git --version # 'git version 2.30.2'
 > git fetch --tags --force --progress -- https://github.com/dmi3x3/app_web.git +refs/heads/*:refs/remotes/origin/* # timeout=10
Seen branch in repository origin/main
Seen 1 remote branch
 > git show-ref --tags -d # timeout=10
Checking out Revision b3055764e155cd7ad25171a35c8ded960274cd47 (origin/main)
 > git config core.sparsecheckout # timeout=10
 > git checkout -f b3055764e155cd7ad25171a35c8ded960274cd47 # timeout=10
Commit message: "fix_149 pipelines build.jenkins file"
 > git rev-list --no-walk ff1aa1a3392a665535e715639c95b3d0f9483f6d # timeout=10
[Pipeline] Start of Pipeline
[Pipeline] podTemplate
[Pipeline] {
[Pipeline] node
Created Pod: kubernetes jenkins/example-job-5-gmvmc-q1skg-ppczw
Agent example-job-5-gmvmc-q1skg-ppczw is provisioned from template example-job_5-gmvmc-q1skg
---
apiVersion: "v1"
kind: "Pod"
metadata:
  annotations:
    buildUrl: "http://jenkins-operator-http-j-instance.jenkins.svc.cluster.local:8080/job/example-job/5/"
    runUrl: "job/example-job/5/"
  labels:
    job: "build-service"
    jenkins: "slave"
    jenkins/label-digest: "5606c9ee6ab88e384e7b32739b94cbcba47ce24b"
    jenkins/label: "example-job_5-gmvmc"
  name: "example-job-5-gmvmc-q1skg-ppczw"
  namespace: "jenkins"
spec:
  containers:
  - command:
    - "cat"
    image: "gcr.io/kaniko-project/executor:debug"
    name: "kaniko"
    tty: true
    volumeMounts:
    - mountPath: "/kaniko/.docker/"
      name: "docker-config"
    - mountPath: "/home/jenkins/agent"
      name: "workspace-volume"
      readOnly: false
  - command:
    - "cat"
    image: "dmi3x3/helmctl:1.0.0"
    name: "helmctl"
    tty: true
    volumeMounts:
    - mountPath: "/home/jenkins/agent"
      name: "workspace-volume"
      readOnly: false
  - env:
    - name: "JENKINS_SECRET"
      value: "********"
    - name: "JENKINS_TUNNEL"
      value: "jenkins-operator-slave-j-instance.jenkins.svc.cluster.local:50000"
    - name: "JENKINS_AGENT_NAME"
      value: "example-job-5-gmvmc-q1skg-ppczw"
    - name: "JENKINS_NAME"
      value: "example-job-5-gmvmc-q1skg-ppczw"
    - name: "JENKINS_AGENT_WORKDIR"
      value: "/home/jenkins/agent"
    - name: "JENKINS_URL"
      value: "http://jenkins-operator-http-j-instance.jenkins.svc.cluster.local:8080/"
    image: "jenkins/inbound-agent:3107.v665000b_51092-5"
    name: "jnlp"
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
    volumeMounts:
    - mountPath: "/home/jenkins/agent"
      name: "workspace-volume"
      readOnly: false
  nodeSelector:
    kubernetes.io/os: "linux"
  restartPolicy: "Never"
  serviceAccountName: "deploy-stage1"
  volumes:
  - hostPath:
      path: "/var/run/docker.sock"
    name: "docker-sock"
  - name: "docker-config"
    secret:
      items:
      - key: ".dockerconfigjson"
        path: "config.json"
      secretName: "dockercred"
  - emptyDir:
      medium: ""
    name: "workspace-volume"

Running on example-job-5-gmvmc-q1skg-ppczw in /home/jenkins/agent/workspace/example-job
[Pipeline] {
[Pipeline] withEnv
[Pipeline] {
[Pipeline] timestamps
[Pipeline] {
[Pipeline] stage
[Pipeline] { (checkout)
[Pipeline] script
[Pipeline] {
[Pipeline] checkout
10:34:22  The recommended git tool is: NONE
10:34:25  No credentials specified
10:34:25  Cloning the remote Git repository
10:34:25  Cloning repository https://github.com/dmi3x3/app_web.git
10:34:25   > git init /home/jenkins/agent/workspace/example-job # timeout=10
10:34:25  Fetching upstream changes from https://github.com/dmi3x3/app_web.git
10:34:25   > git --version # timeout=10
10:34:25   > git --version # 'git version 2.30.2'
10:34:25   > git fetch --tags --force --progress -- https://github.com/dmi3x3/app_web.git +refs/heads/*:refs/remotes/origin/* # timeout=10
10:34:26   > git config remote.origin.url https://github.com/dmi3x3/app_web.git # timeout=10
10:34:26   > git config --add remote.origin.fetch +refs/heads/*:refs/remotes/origin/* # timeout=10
10:34:27  Avoid second fetch
10:34:27  Checking out Revision b3055764e155cd7ad25171a35c8ded960274cd47 (origin/main)
10:34:28  Commit message: "fix_149 pipelines build.jenkins file"
[Pipeline] sh
10:34:27  Seen branch in repository origin/main
10:34:27  Seen 1 remote branch
10:34:27   > git show-ref --tags -d # timeout=10
10:34:28   > git config core.sparsecheckout # timeout=10
10:34:28   > git checkout -f b3055764e155cd7ad25171a35c8ded960274cd47 # timeout=10
10:34:28  + git log -1 --format=%h.%ad --date=format:%Y%m%d-%H%M
10:34:28  + cat
[Pipeline] sh
10:34:29  + git --no-pager tag --points-at HEAD
[Pipeline] echo
10:34:29  checking version tag v1.0.149
[Pipeline] echo
10:34:29  tag not null
[Pipeline] sh
10:34:29  + git --no-pager tag --points-at HEAD
[Pipeline] sh
10:34:30  + echo Building revision: 5-b305576.20230524-1033 build_tag: v1.0.149 gt: true
10:34:30  Building revision: 5-b305576.20230524-1033 build_tag: v1.0.149 gt: true
[Pipeline] }
[Pipeline] // script
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Build Docker Image by kaniko)
[Pipeline] container
[Pipeline] {
[Pipeline] sh
10:34:31  + pwd
10:34:31  + /kaniko/executor --dockerfile Dockerfile --context /home/jenkins/agent/workspace/example-job/ --verbosity debug --insecure --skip-tls-verify --destination dmi3x3/app_web:5-b305576.20230524-1033
10:34:31  [37mDEBU[0m[0000] Copying file /home/jenkins/agent/workspace/example-job/Dockerfile to /kaniko/Dockerfile 
10:34:32  [37mDEBU[0m[0001] Skip resolving path /kaniko/Dockerfile       
10:34:32  [37mDEBU[0m[0001] Skip resolving path /home/jenkins/agent/workspace/example-job/ 
10:34:32  [37mDEBU[0m[0001] Skip resolving path /cache                   
10:34:32  [37mDEBU[0m[0001] Skip resolving path                          
10:34:32  [37mDEBU[0m[0001] Skip resolving path                          
10:34:32  [37mDEBU[0m[0001] Skip resolving path                          
10:34:32  [37mDEBU[0m[0001] Skip resolving path                          
10:34:32  [37mDEBU[0m[0001] Built stage name to index map: map[]         
10:34:32  [36mINFO[0m[0001] Retrieving image manifest nginx:1.23.3       
10:34:32  [36mINFO[0m[0001] Retrieving image nginx:1.23.3 from registry index.docker.io 
10:34:33  [36mINFO[0m[0002] Built cross stage deps: map[]                
10:34:33  [36mINFO[0m[0002] Retrieving image manifest nginx:1.23.3       
10:34:33  [36mINFO[0m[0002] Returning cached image manifest              
10:34:33  [36mINFO[0m[0002] Executing 0 build triggers                   
10:34:33  [36mINFO[0m[0002] Building stage 'nginx:1.23.3' [idx: '0', base-idx: '-1'] 
10:34:33  [36mINFO[0m[0002] Unpacking rootfs as cmd ADD conf /etc/nginx requires it. 
10:34:33  [37mDEBU[0m[0002] Ignore list: [{/kaniko false} {/etc/mtab false} {/tmp/apt-key-gpghome true} {/var/run false} {/proc false} {/dev false} {/dev/pts false} {/dev/mqueue false} {/sys false} {/sys/fs/cgroup false} {/sys/fs/cgroup/systemd false} {/sys/fs/cgroup/net_cls,net_prio false} {/sys/fs/cgroup/cpu,cpuacct false} {/sys/fs/cgroup/rdma false} {/sys/fs/cgroup/freezer false} {/sys/fs/cgroup/blkio false} {/sys/fs/cgroup/memory false} {/sys/fs/cgroup/pids false} {/sys/fs/cgroup/cpuset false} {/sys/fs/cgroup/devices false} {/sys/fs/cgroup/perf_event false} {/sys/fs/cgroup/hugetlb false} {/busybox false} {/kaniko/.docker false} {/etc/hosts false} {/dev/termination-log false} {/etc/hostname false} {/etc/resolv.conf false} {/dev/shm false} {/home/jenkins/agent false} {/var/run/secrets/kubernetes.io/serviceaccount false} {/dev/console false} {/proc/bus false} {/proc/fs false} {/proc/irq false} {/proc/sys false} {/proc/sysrq-trigger false} {/proc/acpi false} {/proc/kcore false} {/proc/keys false} {/proc/timer_list false} {/proc/sched_debug false} {/proc/scsi false} {/sys/firmware false}] 
10:34:33  [37mDEBU[0m[0002] Not adding /dev because it is ignored        
10:34:33  [37mDEBU[0m[0002] Not adding /etc/hostname because it is ignored 
10:34:33  [37mDEBU[0m[0002] Not adding /etc/resolv.conf because it is ignored 
10:34:33  [37mDEBU[0m[0002] Not adding /proc because it is ignored       
10:34:33  [37mDEBU[0m[0002] Not adding /sys because it is ignored        
10:34:35  [37mDEBU[0m[0004] Not adding /var/run because it is ignored    
10:34:37  [37mDEBU[0m[0006] Resolved conf to conf                        
10:34:37  [37mDEBU[0m[0006] Resolved /etc/nginx to /etc/nginx            
10:34:37  [36mINFO[0m[0006] Using files from context: [/home/jenkins/agent/workspace/example-job/conf] 
10:34:37  [36mINFO[0m[0006] ADD conf /etc/nginx                          
10:34:37  [37mDEBU[0m[0006] Resolved conf to conf                        
10:34:37  [37mDEBU[0m[0006] Resolved /etc/nginx to /etc/nginx            
10:34:37  [37mDEBU[0m[0006] found uid -1 and gid -1 for chown string     
10:34:37  [37mDEBU[0m[0006] Resolved conf to conf                        
10:34:37  [37mDEBU[0m[0006] Resolved /etc/nginx to /etc/nginx            
10:34:37  [37mDEBU[0m[0006] Getting files and contents at root /home/jenkins/agent/workspace/example-job/conf/ for /home/jenkins/agent/workspace/example-job/conf 
10:34:37  [37mDEBU[0m[0006] Copying file /home/jenkins/agent/workspace/example-job/conf/nginx.conf to /etc/nginx/nginx.conf 
10:34:37  [37mDEBU[0m[0006] file at /etc/nginx/nginx.conf already exists, resetting file ownership to root 
10:34:37  [36mINFO[0m[0006] Taking snapshot of files...                  
10:34:37  [37mDEBU[0m[0006] Adding to layer: [/ /etc /etc/nginx /etc/nginx/nginx.conf] 
10:34:37  [37mDEBU[0m[0006] Resolved content to content                  
10:34:37  [37mDEBU[0m[0006] Resolved /usr/share/nginx/html to /usr/share/nginx/html 
10:34:37  [36mINFO[0m[0006] Using files from context: [/home/jenkins/agent/workspace/example-job/content] 
10:34:37  [36mINFO[0m[0006] ADD content /usr/share/nginx/html            
10:34:37  [37mDEBU[0m[0006] Resolved content to content                  
10:34:37  [37mDEBU[0m[0006] Resolved /usr/share/nginx/html to /usr/share/nginx/html 
10:34:37  [37mDEBU[0m[0006] found uid -1 and gid -1 for chown string     
10:34:37  [37mDEBU[0m[0006] Resolved content to content                  
10:34:37  [37mDEBU[0m[0006] Resolved /usr/share/nginx/html to /usr/share/nginx/html 
10:34:37  [37mDEBU[0m[0006] Getting files and contents at root /home/jenkins/agent/workspace/example-job/content/ for /home/jenkins/agent/workspace/example-job/content 
10:34:37  [37mDEBU[0m[0006] Copying file /home/jenkins/agent/workspace/example-job/content/index.html to /usr/share/nginx/html/index.html 
10:34:37  [37mDEBU[0m[0006] file at /usr/share/nginx/html/index.html already exists, resetting file ownership to root 
10:34:37  [36mINFO[0m[0006] Taking snapshot of files...                  
10:34:37  [37mDEBU[0m[0006] Adding to layer: [/ /usr /usr/share /usr/share/nginx /usr/share/nginx/html /usr/share/nginx/html/index.html] 
10:34:37  [36mINFO[0m[0006] EXPOSE 80                                    
10:34:37  [36mINFO[0m[0006] Cmd: EXPOSE                                  
10:34:37  [36mINFO[0m[0006] Adding exposed port: 80/tcp                  
10:34:37  [37mDEBU[0m[0006] Build: skipping snapshot for [EXPOSE 80]     
10:34:37  [37mDEBU[0m[0006] Mapping stage idx 0 to digest sha256:c28ff8da39d6d5025fc5134ad46d3c10ce00d64fc3f521eda756e48a0cea51af 
10:34:37  [37mDEBU[0m[0006] Mapping digest sha256:c28ff8da39d6d5025fc5134ad46d3c10ce00d64fc3f521eda756e48a0cea51af to cachekey  
10:34:37  [36mINFO[0m[0006] Pushing image to dmi3x3/app_web:5-b305576.20230524-1033 
10:34:40  [36mINFO[0m[0008] Pushed index.docker.io/dmi3x3/app_web@sha256:209aab0e0bb81d8cb27a76c2361a3ce97f5591b420c1ba589ebcbae75481ba9b 
[Pipeline] }
[Pipeline] // container
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (BUILD Docker Image by kaniko with Tag)
[Pipeline] sh
10:34:40  + git --no-pager tag --points-at HEAD
[Pipeline] echo
10:34:40  checking version tag v1.0.149
[Pipeline] echo
10:34:40  tag not null
[Pipeline] container
[Pipeline] {
[Pipeline] sh
10:34:41  + pwd
10:34:41  + /kaniko/executor --dockerfile Dockerfile --context /home/jenkins/agent/workspace/example-job/ --verbosity debug --insecure --skip-tls-verify --destination dmi3x3/app_web:v1.0.149 --destination dmi3x3/app_web:latest
10:34:41  [37mDEBU[0m[0000] Copying file /home/jenkins/agent/workspace/example-job/Dockerfile to /kaniko/Dockerfile 
10:34:41  [37mDEBU[0m[0000] file at /kaniko/Dockerfile already exists, resetting file ownership to root 
10:34:42  [37mDEBU[0m[0000] Skip resolving path /kaniko/Dockerfile       
10:34:42  [37mDEBU[0m[0000] Skip resolving path /home/jenkins/agent/workspace/example-job/ 
10:34:42  [37mDEBU[0m[0000] Skip resolving path /cache                   
10:34:42  [37mDEBU[0m[0000] Skip resolving path                          
10:34:42  [37mDEBU[0m[0000] Skip resolving path                          
10:34:42  [37mDEBU[0m[0000] Skip resolving path                          
10:34:42  [37mDEBU[0m[0000] Skip resolving path                          
10:34:42  [37mDEBU[0m[0000] Built stage name to index map: map[]         
10:34:42  [36mINFO[0m[0000] Retrieving image manifest nginx:1.23.3       
10:34:42  [36mINFO[0m[0000] Retrieving image nginx:1.23.3 from registry index.docker.io 
10:34:43  [36mINFO[0m[0002] Built cross stage deps: map[]                
10:34:43  [36mINFO[0m[0002] Retrieving image manifest nginx:1.23.3       
10:34:43  [36mINFO[0m[0002] Returning cached image manifest              
10:34:43  [36mINFO[0m[0002] Executing 0 build triggers                   
10:34:43  [36mINFO[0m[0002] Building stage 'nginx:1.23.3' [idx: '0', base-idx: '-1'] 
10:34:43  [36mINFO[0m[0002] Unpacking rootfs as cmd ADD conf /etc/nginx requires it. 
10:34:43  [37mDEBU[0m[0002] Ignore list: [{/kaniko false} {/etc/mtab false} {/tmp/apt-key-gpghome true} {/var/run false} {/proc false} {/dev false} {/dev/pts false} {/dev/mqueue false} {/sys false} {/sys/fs/cgroup false} {/sys/fs/cgroup/systemd false} {/sys/fs/cgroup/net_cls,net_prio false} {/sys/fs/cgroup/cpu,cpuacct false} {/sys/fs/cgroup/rdma false} {/sys/fs/cgroup/freezer false} {/sys/fs/cgroup/blkio false} {/sys/fs/cgroup/memory false} {/sys/fs/cgroup/pids false} {/sys/fs/cgroup/cpuset false} {/sys/fs/cgroup/devices false} {/sys/fs/cgroup/perf_event false} {/sys/fs/cgroup/hugetlb false} {/busybox false} {/kaniko/.docker false} {/etc/hosts false} {/dev/termination-log false} {/etc/hostname false} {/etc/resolv.conf false} {/dev/shm false} {/home/jenkins/agent false} {/var/run/secrets/kubernetes.io/serviceaccount false} {/dev/console false} {/proc/bus false} {/proc/fs false} {/proc/irq false} {/proc/sys false} {/proc/sysrq-trigger false} {/proc/acpi false} {/proc/kcore false} {/proc/keys false} {/proc/timer_list false} {/proc/sched_debug false} {/proc/scsi false} {/sys/firmware false}] 
10:34:43  [37mDEBU[0m[0002] Not adding /dev because it is ignored        
10:34:43  [37mDEBU[0m[0002] Not adding /etc/hostname because it is ignored 
10:34:43  [37mDEBU[0m[0002] Not adding /etc/resolv.conf because it is ignored 
10:34:43  [37mDEBU[0m[0002] Not adding /proc because it is ignored       
10:34:43  [37mDEBU[0m[0002] Not adding /sys because it is ignored        
10:34:44  [37mDEBU[0m[0003] Not adding /var/run because it is ignored    
10:34:46  [37mDEBU[0m[0005] Resolved conf to conf                        
10:34:46  [37mDEBU[0m[0005] Resolved /etc/nginx to /etc/nginx            
10:34:46  [36mINFO[0m[0005] Using files from context: [/home/jenkins/agent/workspace/example-job/conf] 
10:34:46  [36mINFO[0m[0005] ADD conf /etc/nginx                          
10:34:46  [37mDEBU[0m[0005] Resolved conf to conf                        
10:34:46  [37mDEBU[0m[0005] Resolved /etc/nginx to /etc/nginx            
10:34:46  [37mDEBU[0m[0005] found uid -1 and gid -1 for chown string     
10:34:46  [37mDEBU[0m[0005] Resolved conf to conf                        
10:34:46  [37mDEBU[0m[0005] Resolved /etc/nginx to /etc/nginx            
10:34:46  [37mDEBU[0m[0005] Getting files and contents at root /home/jenkins/agent/workspace/example-job/conf/ for /home/jenkins/agent/workspace/example-job/conf 
10:34:46  [37mDEBU[0m[0005] Copying file /home/jenkins/agent/workspace/example-job/conf/nginx.conf to /etc/nginx/nginx.conf 
10:34:46  [37mDEBU[0m[0005] file at /etc/nginx/nginx.conf already exists, resetting file ownership to root 
10:34:46  [36mINFO[0m[0005] Taking snapshot of files...                  
10:34:46  [37mDEBU[0m[0005] Adding to layer: [/ /etc /etc/nginx /etc/nginx/nginx.conf] 
10:34:46  [37mDEBU[0m[0005] Resolved content to content                  
10:34:46  [37mDEBU[0m[0005] Resolved /usr/share/nginx/html to /usr/share/nginx/html 
10:34:46  [36mINFO[0m[0005] Using files from context: [/home/jenkins/agent/workspace/example-job/content] 
10:34:46  [36mINFO[0m[0005] ADD content /usr/share/nginx/html            
10:34:46  [37mDEBU[0m[0005] Resolved content to content                  
10:34:46  [37mDEBU[0m[0005] Resolved /usr/share/nginx/html to /usr/share/nginx/html 
10:34:46  [37mDEBU[0m[0005] found uid -1 and gid -1 for chown string     
10:34:46  [37mDEBU[0m[0005] Resolved content to content                  
10:34:46  [37mDEBU[0m[0005] Resolved /usr/share/nginx/html to /usr/share/nginx/html 
10:34:46  [37mDEBU[0m[0005] Getting files and contents at root /home/jenkins/agent/workspace/example-job/content/ for /home/jenkins/agent/workspace/example-job/content 
10:34:46  [37mDEBU[0m[0005] Copying file /home/jenkins/agent/workspace/example-job/content/index.html to /usr/share/nginx/html/index.html 
10:34:46  [37mDEBU[0m[0005] file at /usr/share/nginx/html/index.html already exists, resetting file ownership to root 
10:34:46  [36mINFO[0m[0005] Taking snapshot of files...                  
10:34:46  [37mDEBU[0m[0005] Adding to layer: [/ /usr /usr/share /usr/share/nginx /usr/share/nginx/html /usr/share/nginx/html/index.html] 
10:34:46  [36mINFO[0m[0005] EXPOSE 80                                    
10:34:46  [36mINFO[0m[0005] Cmd: EXPOSE                                  
10:34:46  [36mINFO[0m[0005] Adding exposed port: 80/tcp                  
10:34:46  [37mDEBU[0m[0005] Build: skipping snapshot for [EXPOSE 80]     
10:34:46  [37mDEBU[0m[0005] Mapping stage idx 0 to digest sha256:9adbec1f71e70e9708cca802256d6825641a0fb75051e94aa0cdfa3cf6e2d990 
10:34:46  [37mDEBU[0m[0005] Mapping digest sha256:9adbec1f71e70e9708cca802256d6825641a0fb75051e94aa0cdfa3cf6e2d990 to cachekey  
10:34:46  [36mINFO[0m[0005] Pushing image to dmi3x3/app_web:v1.0.149     
10:34:49  [36mINFO[0m[0007] Pushed index.docker.io/dmi3x3/app_web@sha256:1dc8d2011e55ee3bf730d5ec903d53cf4c64be7540ab0f56dcc851e4a2446771 
10:34:49  [36mINFO[0m[0007] Pushing image to dmi3x3/app_web:latest       
10:34:51  [36mINFO[0m[0009] Pushed index.docker.io/dmi3x3/app_web@sha256:1dc8d2011e55ee3bf730d5ec903d53cf4c64be7540ab0f56dcc851e4a2446771 
[Pipeline] }
[Pipeline] // container
[Pipeline] }
[Pipeline] // stage
[Pipeline] stage
[Pipeline] { (Run helmctl)
[Pipeline] container
[Pipeline] {
[Pipeline] sh
10:34:52  + helm upgrade app-web-repo app-web-chart --set 'image_frontend.tag=v1.0.149' --install -n stage
10:34:52  Release "app-web-repo" has been upgraded. Happy Helming!
10:34:52  NAME: app-web-repo
10:34:52  LAST DEPLOYED: Wed May 24 07:34:52 2023
10:34:52  NAMESPACE: stage
10:34:52  STATUS: deployed
10:34:52  REVISION: 3
10:34:52  TEST SUITE: None
10:34:52  NOTES:
10:34:52  ---------------------------------------------------------
10:34:52  
10:34:52  Content of NOTES.txt appears after deploy.
10:34:52  Deployed version v1.0.149.
10:34:52  
10:34:52  ---------------------------------------------------------
10:34:52  + kubectl get pods -n stage
10:34:52  NAME                                    READY   STATUS              RESTARTS   AGE
10:34:52  app-web-app-web-repo-6f95967898-zpl5f   1/1     Running             0          20h
10:34:52  app-web-app-web-repo-849c6ccbc6-fjj47   0/1     ContainerCreating   0          0s
[Pipeline] }
[Pipeline] // container
[Pipeline] }
[Pipeline] // stage
[Pipeline] }
[Pipeline] // timestamps
[Pipeline] }
[Pipeline] // withEnv
[Pipeline] }
[Pipeline] // node
[Pipeline] }
[Pipeline] // podTemplate
[Pipeline] End of Pipeline
Finished: SUCCESS
```

</details>

---
## –ß—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Å–¥–∞—á–∏ –∑–∞–¥–∞–Ω–∏—è?

1. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ Terraform –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ø—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ —Å –Ω—É–ª—è.

   –†–µ–∑—É–ª—å—Ç–∞—Ç: [–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ Terraform](https://github.com/dmi3x3/netology_diplom)
2. –ü—Ä–∏–º–µ—Ä pull request —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–º–∏ atlantis'–æ–º.
   
   –†–µ–∑—É–ª—å—Ç–∞—Ç: [pull request](https://github.com/dmi3x3/netology_diplom/pull/3)
3. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π ansible, –µ—Å–ª–∏ –±—ã–ª –≤—ã–±—Ä–∞–Ω —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ ansible.
   
   –†–µ–∑—É–ª—å—Ç–∞—Ç: [kubespray](https://github.com/kubernetes-sigs/kubespray)

   –†–µ–∑—É–ª—å—Ç–∞—Ç: [inventory.tf](https://raw.githubusercontent.com/dmi3x3/netology_diplom/main/inventory.tf)

   –†–µ–∑—É–ª—å—Ç–∞—Ç: [inventory.tmpl](https://raw.githubusercontent.com/dmi3x3/netology_diplom/main/inventory.tmpl)

   –†–µ–∑—É–ª—å—Ç–∞—Ç: [example_stage-inventory](https://raw.githubusercontent.com/dmi3x3/netology_diplom/main/example_stage-inventory)
4. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å Dockerfile —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ–±—Ä–∞–Ω–Ω—ã–π docker image.
   
   –†–µ–∑—É–ª—å—Ç–∞—Ç: [Dockerfile](https://raw.githubusercontent.com/dmi3x3/app_web/main/Dockerfile)

   –†–µ–∑—É–ª—å—Ç–∞—Ç: [docker image](https://hub.docker.com/layers/dmi3x3/app_web/v1.0.149/images/sha256-1dc8d2011e55ee3bf730d5ec903d53cf4c64be7540ab0f56dcc851e4a2446771?context=explore)
    ```commandline
    docker pull dmi3x3/app_web:v1.0.149
    ```
5. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π Kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞.

   –†–µ–∑—É–ª—å—Ç–∞—Ç: [ansible.tf](https://raw.githubusercontent.com/dmi3x3/netology_diplom/main/ansible.tf)

   –†–µ–∑—É–ª—å—Ç–∞—Ç: [atlantis.tf](https://raw.githubusercontent.com/dmi3x3/netology_diplom/main/atlantis.tf)
6. –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤–µ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Grafana —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–æ—Å—Ç—É–ø–∞.
   
   –†–µ–∑—É–ª—å—Ç–∞—Ç: [—Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ](http://158.160.35.78/)
   
   –†–µ–∑—É–ª—å—Ç–∞—Ç: [–≤–µ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Grafana](http://158.160.35.78:3000/login) (admin/admin)
7. –í—Å–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ –æ–¥–Ω–æ–º —Ä–µ—Å—É—Ä—Å–µ (github, gitlab)

    –†–µ–∑—É–ª—å—Ç–∞—Ç: [github.com/dmi3x3](https://github.com/dmi3x3)
---
–ü—Ä–∏ –ø—Ä–∏ 
–ß—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—ã–ª–æ "production" –≤–µ—Ä—Å–∏–∏, jenkins –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ —Ä–µ–µ—Å—Ç—Ä –æ–±—Ä–∞–∑–∞ —Å —Ç–µ–≥–æ–º, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –∂–µ —Å —Ç–µ–≥–æ–º latest.
–ü–æ–ª—É—á–∞–µ—Ç—Å—è, –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ kubernetes –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏–∑ terraform —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–µ–ø–ª–æ–∏—Ç—Å—è –≤ –∫—É–±–µ—Ä —Å —Ç–µ–≥–æ–º latest (–Ω–∞ –º–æ–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∫—É–±–µ—Ä–∞ —ç—Ç–æ –ø–æ—Å–ª–µ–¥–Ω—è—è "production" –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è), –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–µ–ø–ª–æ–∏—Ç jenkins. 
---

## –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞:

1. –°–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å kubespray:

```commandline
git clone https://github.com/kubernetes-sigs/kubespray.git
```
2. –°–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç:
```commandline
git clone https://github.com/dmi3x3/netology_diplom.git
```
3. –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å—Å—è –≤ –ø—Ä–æ–µ–∫—Ç:
```commandline
cd netology_diplom
```
4. –°–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç:
```commandline
git clone https://github.com/dmi3x3/app_web.git
```
5. –û–±–µ—Å–ø–µ—á–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤ —ç—Ç–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ —Ñ–∞–π–ª–æ–≤ auto.tfvars, key.json - –¥–ª—è –∏—Ö —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—ç–º–ø–ª—ã.
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤ $HOME/.ssh/ –∫–ª—é—á–∞ id_ed25519_atlant –∏–ª–∏ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ —Å–≤–æ–π –≤ atlantis.tf
7. –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è s3-backet –≤—ã–ø–æ–ª–Ω–∏—Ç—å terraform init/plan/apply –≤ –∫–∞—Ç–∞–ª–æ–≥–µ S3.
```commandline
cd S3
terraform init
terraform plan
terraform apply -auto-approve
```
7. –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã bucket –≤–Ω–µ—Å—Ç–∏ –≤ provider.tf
8. –í—ã–ø–æ–ª–Ω–∏—Ç—å terraform init/plan/apply
```commandline
cd ../
terraform init
terraform plan
terraform apply -auto-approve
```
9. –î–æ–∂–¥–∞—Ç—å—Å—è –ü—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö terraform –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –∏ –≤—ã–≤–æ–¥–∞ –∫–æ–º–∞–Ω–¥—ã terraform output, –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è –æ—Ç jenkins –≤ –∫–æ–Ω—Å–æ–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å
```commandline
echo -e "`kubectl get -n jenkins secret jenkins-operator-credentials-j-instance -o 'jsonpath={.data.user}' | base64 -d`\n`kubectl get -n jenkins secret jenkins-operator-credentials-j-instance -o 'jsonpath={.data.password}' | base64 -d`"
```

---
## –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –≤–æ–∑–Ω–∏–∫—à–∏–µ –ø—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –¥–∏–ø–ª–æ–º–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

### Terraform
–ü—Ä–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –æ–¥–Ω–æ –∏–∑ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π, –¥–æ—Ä–∞–±–æ—Ç–∞–≤ –µ–≥–æ –ø–æ–¥ —Å–µ–±—è. –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ –∫–æ–º–∞–Ω–¥—ã terraform plan, terraform apply –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏ —à—Ç–∞—Ç–Ω–æ, –±–µ–∑ –ø—Ä–æ–±–ª–µ–º, –Ω–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —ç—Ç–∏—Ö –∫–æ–º–∞–Ω–¥ –≤ –∑–∞–ø—É—â–µ–Ω–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ, –ø–ª–∞–Ω —Å–æ–æ–±—â–∞–ª, —á—Ç–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ –Ω–æ–¥—ã, –∞ apply –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–ª –∏—Ö.

–ù–∞–ª–∏—Ü–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ. –ü–æ–∏—Å–∫ –ø—Ä–∏—á–∏–Ω—ã —Ç–∞–∫–æ–≥–æ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏–≤–µ–ª –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä—É type = "network-nvme" 
![img_47.png](img/img_47.png)
–ø—Ä–æ–≤–∞–π–¥–µ—Ä —Ç–µ—Ä—Ä–∞—Ñ–æ—Ä–º yandex —Å–æ–∑–¥–∞–≤–∞–ª –í–ú —Å —ç—Ç–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º, –Ω–æ —Å –∫–∞–∂–¥—ã–º plan/apply –ø—ã—Ç–∞–ª—Å—è –∏–∑–º–µ–Ω–∏—Ç—å –µ–≥–æ.
–ø–æ—Å–ª–µ —Å–º–µ–Ω—ã —ç—Ç–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –Ω–∞ type = "network-ssd", —Ç–µ—Ä—Ä–∞—Ñ–æ—Ä–º —Å—Ç–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å —à—Ç–∞—Ç–Ω–æ, –æ–∂–∏–¥–∞–µ–º–æ.
–¢–ü –Ø–Ω–¥–µ–∫—Å.–û–±–ª–∞–∫–æ —Å–æ–æ–±—â–∏–ª–∞, —á—Ç–æ –¥–∞–Ω–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –æ—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, —Ö–æ—Ç—è –Ω–µ —è—Å–Ω–æ, –∫–∞–∫ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –í–ú –ø–æ–º–æ–∂–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏? –û–±–µ—â–∞–ª–∏ —Å–æ–æ–±—â–∏—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º.

### Jenkins

–î–ª—è ci/cd –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª Jenkins Operator, –Ω–∞—Ç–∏–≤–Ω—ã–π –∫—É–±–µ—Ä–Ω–µ—Ç–µ—Å-–æ–ø–µ—Ä–∞—Ç–æ—Ä. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏–ª–æ –ø–æ–º–µ—Å—Ç–∏—Ç—å –≤—Å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é jenkins –≤ –ø—Ä–æ–µ–∫—Ç —Å [—Ç–µ—Å—Ç–æ–≤—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º](https://github.com/dmi3x3/app_web/tree/main/cicd). –ü—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ —Å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ–º –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ CRD –∏ docker-–æ–±—Ä–∞–∑–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞, –∑–∞–º–µ–Ω–∏–ª –≤–µ—Ä—Å–∏—é –æ–±—Ä–∞–∑–∞:
```commandline
image: virtuslab/jenkins-operator:v0.7.1 => image: virtuslab/jenkins-operator:60b8ee5
```

—Ç–∞–∫–∂–µ –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª–æ—Å—å —É–∫–∞–∑–∞—Ç—å –≤–µ—Ä—Å–∏–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤, —Ç.–∫. —Å –≤–µ—Ä—Å–∏—è–º–∏ –ø–ª–∞–≥–∏–Ω–æ–≤ –ø–æ-—É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–¥ –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç, –∏–¥–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫.

–ò –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –≤–º–µ—Å—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å docker –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è docker –æ–±—Ä–∞–∑–æ–≤, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª kaniko, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –∑–∞–ø—É—Å–∫–æ–º –≤ –∫—É–±–µ—Ä–Ω–µ—Ç–µ—Å.

---
## –ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –¥–∏–ø–ª–æ–º–Ω–æ–º—É —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é?

–ß—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º:

1. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –Ω–∞–π—Ç–∏ –æ—Ç–≤–µ—Ç —Å–Ω–∞—á–∞–ª–∞ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ –∏–ª–∏ –≤ 
  –º–∞—Ç–µ—Ä–∏–∞–ª–∞—Ö –∫—É—Ä—Å–∞ –∏ –î–ó –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å —É –¥–∏–ø–ª–æ–º–Ω–æ–≥–æ 
  —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è. –ù–∞–≤—ã–∫ –ø–æ–∏—Å–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –ø—Ä–∏–≥–æ–¥–∏—Ç—Å—è –≤–∞–º –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π 
  –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
2. –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –±–æ–ª—å—à–µ –æ–¥–Ω–æ–≥–æ, –ø—Ä–∏—Å—ã–ª–∞–π—Ç–µ –∏—Ö –≤ –≤–∏–¥–µ –Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ 
  —Å–ø–∏—Å–∫–∞. –¢–∞–∫ –¥–∏–ø–ª–æ–º–Ω–æ–º—É —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—é –±—É–¥–µ—Ç –ø—Ä–æ—â–µ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∫–∞–∂–¥—ã–π –∏–∑ 
  –Ω–∏—Ö.
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ –∫ –≤–æ–ø—Ä–æ—Å—É —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏ —Å—Ç—Ä–µ–ª–æ—á–∫–æ–π 
  –ø–æ–∫–∞–∂–∏—Ç–µ, –≥–¥–µ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è.

–ß—Ç–æ –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–æ–±–ª–µ–º:

1. –í–æ–ø—Ä–æ—Å—ã –≤–∏–¥–∞ ¬´–ù–∏—á–µ–≥–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ù–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è. –í—Å—ë —Å–ª–æ–º–∞–ª–æ—Å—å¬ª. 
  –î–∏–ø–ª–æ–º–Ω—ã–π —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –Ω–µ —Å–º–æ–∂–µ—Ç –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ —Ç–∞–∫–æ–π –≤–æ–ø—Ä–æ—Å –±–µ–∑ 
  –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Ç–æ—á–Ω–µ–Ω–∏–π. –¶–µ–Ω–∏—Ç–µ —Å–≤–æ—ë –≤—Ä–µ–º—è –∏ –≤—Ä–µ–º—è –¥—Ä—É–≥–∏—Ö.
2. –û—Ç–∫–ª–∞–¥—ã–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫—É—Ä—Å–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–æ–º–µ–Ω—Ç.
3. –û–∂–∏–¥–∞–Ω–∏–µ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å. –î–∏–ø–ª–æ–º–Ω—ã–µ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏ - –ø—Ä–∞–∫—Ç–∏–∫—É—é—â–∏–µ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–Ω–∏–º–∞—é—Ç—Å—è, –∫—Ä–æ–º–µ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è, 
  —Å–≤–æ–∏–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏. –ò—Ö –≤—Ä–µ–º—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ, –ø–æ—ç—Ç–æ–º—É –ø–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –∑–∞–¥–∞–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç—å –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã :)
